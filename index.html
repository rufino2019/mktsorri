<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BI Command Center - Master Performance</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #020617; --card-bg: #0f172a; --accent: #3b82f6; --text-main: #f8fafc;
            --text-dim: #94a3b8; --border: #1e293b; --success: #10b981; --gold: #fbbf24;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding: 20px; color: var(--text-main); }
        .container { max-width: 1600px; margin: auto; }
        
        /* CABEÇALHO GLOBAL */
        .global-monitor-box { 
            background: linear-gradient(180deg, #0f172a 0%, #020617 100%);
            padding: 35px; border-radius: 40px; border: 1px solid var(--border);
            margin-bottom: 30px; box-shadow: 0 40px 80px -20px rgba(0,0,0,0.8);
        }
        .global-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; margin-bottom: 30px; }
        .global-item { text-align: center; border-right: 1px solid var(--border); }
        .global-item:last-child { border-right: none; }
        .global-item h2 { color: var(--text-dim); font-size: 10px; text-transform: uppercase; letter-spacing: 0.2em; margin-bottom: 10px; }
        .global-item .amount { font-size: 26px; font-weight: 800; color: #fff; display: block; }

        /* TABELA DE RANKING COM ROLAGEM */
        .ranking-wrapper { 
            background: rgba(255,255,255,0.02); border-radius: 20px; border: 1px solid var(--border);
            overflow: hidden; margin-top: 10px;
        }
        .scroll-container { max-height: 280px; overflow-y: auto; }
        .scroll-container::-webkit-scrollbar { width: 6px; }
        .scroll-container::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }
        
        table.rank-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        table.rank-table thead { position: sticky; top: 0; background: #1e293b; z-index: 10; }
        table.rank-table th { padding: 12px 15px; text-align: left; color: var(--text-dim); text-transform: uppercase; cursor: pointer; transition: 0.2s; }
        table.rank-table th:hover { color: #fff; background: rgba(255,255,255,0.05); }
        table.rank-table td { padding: 10px 15px; border-bottom: 1px solid rgba(255,255,255,0.03); }
        
        .lvl-badge { padding: 3px 8px; border-radius: 6px; font-size: 10px; font-weight: 800; color: #fff; }

        /* SELETOR UNITÁRIO */
        .clinic-selector-bar { 
            background: var(--card-bg); padding: 20px 40px; border-radius: 30px; border: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;
        }
        select { padding: 12px 25px; border-radius: 12px; border: 1px solid var(--border); background: #1e293b; color: #fff; width: 450px; cursor: pointer; font-weight: 700; outline: none; }

        /* DASHBOARD UNITÁRIA */
        .unit-kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; }
        .u-card { background: var(--card-bg); padding: 25px; border-radius: 20px; border: 1px solid var(--border); position: relative; }
        .u-card .val { font-size: 22px; font-weight: 800; margin-top: 8px; display: block; }
        .main-layout { display: grid; grid-template-columns: 1fr 1.2fr 1fr; gap: 25px; }
        .panel { background: var(--card-bg); padding: 30px; border-radius: 35px; border: 1px solid var(--border); }
        .panel h3 { font-size: 16px; margin: 0 0 25px; font-weight: 700; border-left: 5px solid var(--accent); padding-left: 15px; }

        .funnel-container { display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .f-step { width: 100%; text-align: center; color: white; font-weight: 800; padding: 18px 0; border-radius: 10px; font-size: 13px; }
        .f-leads { background: linear-gradient(180deg, #6366f1, #4338ca); clip-path: polygon(0% 0%, 100% 0%, 93% 100%, 7% 100%); }
        .f-budget { background: linear-gradient(180deg, #3b82f6, #1d4ed8); width: 85%; clip-path: polygon(0% 0%, 100% 0%, 90% 100%, 10% 100%); }
        .f-revenue { background: linear-gradient(180deg, #10b981, #065f46); width: 65%; border-radius: 0 0 20px 20px; }

        .tag { display: inline-block; background: rgba(59, 130, 246, 0.05); color: #60a5fa; padding: 6px 12px; border-radius: 8px; margin: 4px; font-size: 11px; border: 1px solid rgba(59, 130, 246, 0.1); }
        .hood-list { max-height: 350px; overflow-y: auto; }
    </style>
</head>
<body>

<div class="container">
    <div class="global-monitor-box">
        <div class="global-grid">
            <div class="global-item"><h2>Unidades</h2><span class="amount">22</span></div>
            <div class="global-item"><h2>Total Ads</h2><span class="amount">R$ 52.519,09</span></div>
            <div class="global-item"><h2>Orçado</h2><span class="amount">R$ 3.132.288,36</span></div>
            <div class="global-item"><h2>Efetivado</h2><span class="amount" style="color:var(--success)">R$ 744.376,42</span></div>
            <div class="global-item"><h2>ROI Global</h2><span class="amount" style="color:var(--gold)">1.317%</span></div>
        </div>

        <div class="ranking-wrapper">
            <div class="scroll-container">
                <table class="rank-table" id="rankTable">
                    <thead>
                        <tr>
                            <th>Clínica</th>
                            <th onclick="sortTable(1)">Nível</th>
                            <th onclick="sortTable(2)">Investimento ▼</th>
                            <th onclick="sortTable(3)">Faturamento ▼</th>
                            <th onclick="sortTable(4)">Custo Lead ▼</th>
                            <th onclick="sortTable(5)">ROI ▼</th>
                        </tr>
                    </thead>
                    <tbody id="rankBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="clinic-selector-bar">
        <h1 id="clinicTitle" style="font-size:20px; margin:0;">Análise Individual</h1>
        <select id="clinicSelect" onchange="updateUI(this.value)"></select>
    </div>

    <div class="unit-kpi-grid">
        <div class="u-card"><h4>Orçamento</h4><span id="uBudget" class="val">--</span></div>
        <div class="u-card"><h4>Faturamento</h4><span id="uRevenue" class="val" style="color:var(--success)">--</span></div>
        <div class="u-card"><h4>Investimento</h4><span id="uSpend" class="val">--</span></div>
        <div class="u-card"><h4>ROI</h4><span id="uROI" class="val">--</span><span id="uCat" class="lvl-badge" style="position:absolute; top:15px; right:15px;">--</span></div>
    </div>

    <div class="dash-layout">
        <div class="panel">
            <h3>Funil</h3>
            <div class="funnel-container">
                <div class="f-step f-leads"><span id="fLeads">0</span> Leads</div>
                <div class="f-step f-budget">R$ <span id="fBudget">0</span> Orçado</div>
                <div class="f-step f-revenue">R$ <span id="fRevenue">0</span> Efetivado</div>
            </div>
            <div style="text-align:center; margin-top:25px; padding:15px; border:1px dashed var(--border); border-radius:20px;">
                <span style="font-size:10px; color:var(--text-dim); text-transform:uppercase;">Conversão</span>
                <div id="fConv" style="font-size:28px; font-weight:900; color:var(--success)">0%</div>
            </div>
        </div>

        <div class="panel">
            <h3>Idades</h3>
            <div style="height: 280px;"><canvas id="ageChart"></canvas></div>
            <div style="margin-top:25px; text-align:center;"><span id="vGender" style="font-weight:800; font-size:16px; color:#ec4899;">FEMININO</span></div>
        </div>

        <div class="panel"><h3>Bairros</h3><div class="hood-list" id="hoodBox"></div></div>
    </div>
</div>

<script>
const db = [{"name": "Santa Maria - Praça Saldanha Marinho", "investment": 2013.53, "revenue": 39247.33, "cpl": 16.24, "roi": 1849.2, "roi_cat": "Ouro", "roi_color": "#fbbf24", "roi_level": 3, "budget": 351882.0, "leads": 124, "conv": 11.2, "female": 78.6, "age": [1, 10, 3, 9, 5], "hoods": ["Arroio Grande", "Bonfim", "Camobi", "Centro", "JK", "Patronato"]}, {"name": "Carazinho", "investment": 2535.4, "revenue": 10616.04, "cpl": 31.3, "roi": 318.7, "roi_cat": "Atenção", "roi_color": "#f43f5e", "roi_level": 1, "budget": 42593.0, "leads": 81, "conv": 24.9, "female": 47.4, "age": [6, 3, 4, 4, 2], "hoods": ["Centro", "Floresta", "Gloria", "Santo Antonio"]}, {"name": "Erechim", "investment": 884.67, "revenue": 28052.63, "cpl": 17.35, "roi": 3071.0, "roi_cat": "Diamante", "roi_color": "#2dd4bf", "roi_level": 4, "budget": 156627.4, "leads": 51, "conv": 17.9, "female": 50.0, "age": [1, 6, 8, 4, 3], "hoods": ["Ipiranga", "Koller", "Zimmer"]}, {"name": "Uruguaiana", "investment": 5733.08, "revenue": 68544.81, "cpl": 28.81, "roi": 1095.6, "roi_cat": "Prata", "roi_color": "#94a3b8", "roi_level": 2, "budget": 127808.0, "leads": 199, "conv": 53.6, "female": 58.7, "age": [7, 20, 24, 14, 10], "hoods": ["Centro", "Santana", "São João"]}, {"name": "Lajeado", "investment": 1629.45, "revenue": 38371.8, "cpl": 13.25, "roi": 2254.9, "roi_cat": "Ouro", "roi_color": "#fbbf24", "roi_level": 3, "budget": 101686.0, "leads": 123, "conv": 37.7, "female": 63.2, "age": [3, 14, 14, 6, 1], "hoods": ["Centro", "Montanha", "São Cristóvão"]}, {"name": "São Gabriel", "investment": 436.2, "revenue": 21718.99, "cpl": 9.69, "roi": 4879.1, "roi_cat": "Diamante", "roi_color": "#2dd4bf", "roi_level": 4, "budget": 39606.0, "leads": 45, "conv": 54.8, "female": 58.8, "age": [2, 7, 4, 3, 1], "hoods": ["Bomfim", "Centro", "Esplanada"]}, {"name": "Santiago", "investment": 3466.77, "revenue": 95335.36, "cpl": 25.12, "roi": 2650.0, "roi_cat": "Diamante", "roi_color": "#2dd4bf", "roi_level": 4, "budget": 136814.0, "leads": 138, "conv": 69.7, "female": 70.4, "age": [4, 6, 9, 6, 2], "hoods": ["Centro", "Guabiroba", "Lulu Genro"]}, {"name": "Itaqui", "investment": 2131.9, "revenue": 5609.91, "cpl": 14.03, "roi": 163.1, "roi_cat": "Atenção", "roi_color": "#f43f5e", "roi_level": 1, "budget": 26439.0, "leads": 152, "female": 62.5, "age": [2, 5, 8, 0, 1], "hoods": ["Alvorada", "Centro", "Promorar"]}, {"name": "Caruaru", "investment": 3057.32, "revenue": 100047.74, "cpl": 11.54, "roi": 3172.4, "roi_cat": "Diamante", "roi_color": "#2dd4bf", "roi_level": 4, "budget": 245641.0, "leads": 265, "conv": 40.7, "female": 43.2, "age": [2, 8, 13, 13, 8], "hoods": ["Boa Vista", "Centro", "Indianópolis", "Universitário"]}, {"name": "Ibiporã", "investment": 2523.38, "revenue": 13970.4, "cpl": 31.54, "roi": 453.6, "roi_cat": "Atenção", "roi_color": "#f43f5e", "roi_level": 1, "budget": 188898.0, "leads": 80, "female": 74.3, "age": [3, 11, 13, 7, 1], "hoods": ["Centro", "Mustafa", "Setor 2"]}, {"name": "Montenegro", "investment": 1987.22, "revenue": 21940.0, "cpl": 21.37, "roi": 1004.1, "roi_cat": "Prata", "roi_color": "#94a3b8", "roi_level": 2, "budget": 53609.0, "leads": 93, "conv": 40.9, "female": 44.4, "age": [0, 3, 0, 4, 2], "hoods": ["Centenário", "Centro", "Santa Rita"]}, {"name": "Indaiatuba", "investment": 2831.63, "revenue": 82612.12, "cpl": 27.76, "roi": 2817.5, "roi_cat": "Diamante", "roi_color": "#2dd4bf", "roi_level": 4, "budget": 117104.5, "leads": 102, "conv": 70.5, "female": 52.6, "age": [3, 2, 3, 7, 4], "hoods": ["Centro", "Jardim Bréscia", "Vila Avaí"]}, {"name": "Paulínia", "investment": 2374.15, "revenue": 38039.46, "cpl": 35.44, "roi": 1502.2, "roi_cat": "Ouro", "roi_color": "#fbbf24", "roi_level": 3, "budget": 442740.5, "leads": 67, "conv": 8.6, "female": 44.4, "age": [1, 11, 11, 8, 5], "hoods": ["João Aranha", "São Luiz", "Vila San Martin"]}, {"name": "Londrina - Av. Bandeirantes", "investment": 2527.49, "revenue": 28538.83, "cpl": 16.63, "roi": 1029.1, "roi_cat": "Prata", "roi_color": "#94a3b8", "roi_level": 2, "budget": 128982.0, "leads": 152, "conv": 22.1, "female": 65.0, "age": [3, 2, 9, 3, 3], "hoods": ["Bandeirantes", "Centro", "Gleba Palhano"]}, {"name": "Curitiba", "investment": 448.14, "revenue": 6220.01, "cpl": 19.48, "roi": 1288.0, "roi_cat": "Prata", "roi_color": "#94a3b8", "roi_level": 2, "budget": 69986.5, "leads": 23, "conv": 8.9, "female": 33.3, "age": [0, 0, 0, 3, 3], "hoods": ["Cidade Industrial", "Novo Mundo", "Portão"]}, {"name": "Maringá - Souza Naves", "investment": 2184.17, "revenue": 8025.0, "cpl": 22.06, "roi": 267.4, "roi_cat": "Atenção", "roi_color": "#f43f5e", "roi_level": 1, "budget": 108484.4, "leads": 99, "conv": 7.4, "female": 55.2, "age": [2, 7, 9, 10, 1], "hoods": ["Centro", "Jardim Alvorada", "Zona 07"]}];

// POPULAR TABELA
const body = document.getElementById('rankBody');
function renderTable(list) {
    body.innerHTML = '';
    list.forEach(item => {
        const row = `<tr>
            <td>${item.name.split(' - ')[0]}</td>
            <td><span class="lvl-badge" style="background:${item.roi_color}">${item.roi_cat}</span></td>
            <td>R$ ${item.investment.toLocaleString('pt-BR')}</td>
            <td>R$ ${item.revenue.toLocaleString('pt-BR')}</td>
            <td>R$ ${item.cpl.toFixed(2)}</td>
            <td style="color:${item.roi_color}; font-weight:800;">${item.roi.toFixed(0)}%</td>
        </tr>`;
        body.innerHTML += row;
    });
}
renderTable(db);

// FUNÇÃO DE ORDENAÇÃO
let currentOrder = -1;
function sortTable(colIndex) {
    currentOrder *= -1;
    const sorted = [...db].sort((a, b) => {
        const keys = ['name', 'roi_level', 'investment', 'revenue', 'cpl', 'roi'];
        const valA = a[keys[colIndex]];
        const valB = b[keys[colIndex]];
        return (valA > valB ? 1 : -1) * currentOrder;
    });
    renderTable(sorted);
}

// SELETOR
const sel = document.getElementById('clinicSelect');
db.sort((a,b)=>a.name.localeCompare(b.name)).forEach(c => {
    sel.innerHTML += `<option value="${c.name}">${c.name}</option>`;
});

let ageChartInstance = null;
function updateUI(name) {
    const d = db.find(x => x.name === name);
    document.getElementById('clinicTitle').innerText = name;
    document.getElementById('uBudget').innerText = `R$ ${d.budget.toLocaleString('pt-BR')}`;
    document.getElementById('uRevenue').innerText = `R$ ${d.revenue.toLocaleString('pt-BR')}`;
    document.getElementById('uSpend').innerText = `R$ ${d.investment.toLocaleString('pt-BR')}`;
    document.getElementById('uROI').innerText = `${d.roi.toFixed(1)}%`;
    const cat = document.getElementById('uCat'); cat.innerText = d.roi_cat; cat.style.backgroundColor = d.roi_color;
    document.getElementById('fLeads').innerText = d.leads;
    document.getElementById('fBudget').innerText = d.budget.toLocaleString('pt-BR');
    document.getElementById('fRevenue').innerText = d.revenue.toLocaleString('pt-BR');
    document.getElementById('fConv').innerText = `${d.conv.toFixed(1)}%`;
    document.getElementById('hoodBox').innerHTML = d.hoods.map(h => `<span class="tag">${h}</span>`).join('');
    document.getElementById('vGender').innerText = d.female > 50 ? 'FEMININO' : 'MASCULINO';

    if(ageChartInstance) ageChartInstance.destroy();
    ageChartInstance = new Chart(document.getElementById('ageChart'), {
        type: 'bar',
        data: { labels: ['0-18', '19-30', '31-45', '46-60', '60+'], datasets: [{ data: d.age, backgroundColor: d.roi_color, borderRadius: 10 }] },
        options: { responsive: true, maintainAspectRatio: false, scales: { y: { grid: { color: 'rgba(255,255,255,0.05)' } }, x: { grid: { display: false } } }, plugins: { legend: { display: false } } }
    });
}
updateUI(db[0].name);
</script>
</body>
</html>
